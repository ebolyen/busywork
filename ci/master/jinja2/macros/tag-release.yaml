{%- macro make_config(projects) %}
platform: linux

image_resource:
  type: docker-image
  source:
    repository: condaforge/linux-anvil
    version: latest

params:
  - PATH: /opt/conda/bin:/opt/rh/devtoolset-2/root/usr/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/root/bin
  - REPOS_STRING: "{{ projects|join(' ', attribute='name') }}"
  {%- raw %}
  - GITHUB_USER: {{github_user}}
  - GITHUB_PASS: {{github_pass}}
  {%- endraw %}

inputs:
  - name: busywork
  {%- for project in projects %}
  - name: {{ project.name }}-source
  {%- endfor %}

outputs:
  {%- for project in projects %}
  - name: tagged-{{ project.name }}-source
  {%- endfor %}

run:
  path: busywork/ci/master/bin/tag-release.sh
{%- endmacro %}
